<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Redefinir Senha - ONS</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
  <h2>Redefinir Senha</h2>
  <form id="reset-form">
    <input type="password" id="password" placeholder="Nova senha" required minlength="6">
    <input type="password" id="confirm-password" placeholder="Confirmar nova senha" required minlength="6">
    <button type="submit">Redefinir</button>
  </form>
  <div id="msg"></div>
  <div id="debug"></div>
  <script>
    // Troque pelos seus dados do Supabase
    const SUPABASE_URL = 'https://nipdcwstzslbwgixdpmz.supabase.co';
    const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5pcGRjd3N0enNsYndnaXhkcG16Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTE1NTMwMzEsImV4cCI6MjA2NzEyOTAzMX0.l5sq2elzhx1OaP91r9inOTKkLGfaiOgP4MMV-7XA6Ro';

    const { createClient } = supabase;
    const supabaseClient = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    function logDebug(...args) {
      console.log(...args);
      const debugDiv = document.getElementById('debug');
      debugDiv.innerHTML += args.map(a => 
        (typeof a === 'object' ? `<pre>${JSON.stringify(a, null, 2)}</pre>` : a)
      ).join(' ') + '<br>';
    }

    // Loga a sessão ao carregar
    supabaseClient.auth.getSession().then(({ data, error }) => {
      logDebug("Sessão atual do Supabase:", data, error);
    });

    document.getElementById('reset-form').addEventListener('submit', async function(e) {
      e.preventDefault();
      const password = document.getElementById('password').value;
      const confirmPassword = document.getElementById('confirm-password').value;
      const msgDiv = document.getElementById('msg');
      msgDiv.textContent = '';

      if (password !== confirmPassword) {
        msgDiv.textContent = 'As senhas não coincidem.';
        return;
      }

      try {
        const { data, error } = await supabaseClient.auth.updateUser({ password });
        logDebug("Resultado do updateUser:", data, error);
        if (error) {
          msgDiv.textContent = 'Erro: ' + error.message;
        } else {
          msgDiv.textContent = 'Senha redefinida com sucesso!';
        }
      } catch (err) {
        msgDiv.textContent = 'Erro inesperado. Tente novamente.';
        logDebug("Erro inesperado:", err);
      }
    });
  </script>
</body>
</html>